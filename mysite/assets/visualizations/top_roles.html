<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reddit Roles - Details</title>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        body {
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
            background-color: #ffffff;
            color: #333;
            margin: 0;
            padding: 20px;
        }

        #details-container {
            display: grid;
            grid-template-columns: 1fr 1fr; /* 2x2 grid */
            gap: 20px;
            width: 100%;
            max-width: 1000px;
            margin: 0 auto;
        }

        .role-panel {
            background: #fff;
            border: 1px solid #eee;
            padding: 15px;
            border-radius: 4px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
        }

        .role-title {
            font-family: Georgia, serif;
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 10px;
            padding-bottom: 5px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
        }

        .bar-label { font-size: 11px; fill: #333; }
        .bar-value { font-size: 10px; fill: #666; font-weight: bold; }
    </style>
</head>
<body>

    <div id="details-container"></div>

    <script>
        const COLORS = {
            "Influential": "#f1c40f",
            "Supportive": "#27ae60",
            "Controversial": "#8e44ad",
            "Critical": "#c0392b"
        };

        async function initDetails() {
            try {
                const data = await d3.json('../data/roles.json');
                const roles = ["Influential", "Supportive", "Controversial", "Critical"];
                
                // Render the 4 panels
                roles.forEach(role => {
                    if (data.top_by_role[role]) {
                        drawDetailPanel(role, data.top_by_role[role]);
                    }
                });
            } catch (error) {
                console.error("Error loading data:", error);
            }
        }

        function drawDetailPanel(role, clusterList) {
            const container = d3.select("#details-container");
            const panel = container.append("div").attr("class", "role-panel");
            
            // Header
            panel.append("div")
                .attr("class", "role-title")
                .style("color", COLORS[role])
                .html(`<span>${role}</span> <span style='font-weight:normal; font-size:12px; color:#999'>Top Clusters</span>`);

            // Dimensions
            const width = 300;
            const height = 180;
            const margin = {top: 10, right: 40, bottom: 10, left: 120};

            const svg = panel.append("svg")
                .attr("width", "100%")
                .attr("viewBox", `0 0 ${width + margin.left + margin.right} ${height + margin.top + margin.bottom}`)
                .append("g")
                .attr("transform", `translate(${margin.left},${margin.top})`);

            // Scales
            const maxVal = d3.max(clusterList, d => d.pct);
            const x = d3.scaleLinear().domain([0, maxVal * 1.2]).range([0, width]);
            const y = d3.scaleBand().range([0, height]).domain(clusterList.map(d => d.name)).padding(0.2);

            // Bars
            svg.selectAll("rect")
                .data(clusterList)
                .join("rect")
                .attr("x", x(0))
                .attr("y", d => y(d.name))
                .attr("width", d => x(d.pct))
                .attr("height", y.bandwidth())
                .attr("fill", COLORS[role])
                .attr("rx", 3);

            // Text Labels
            svg.selectAll(".bar-label")
                .data(clusterList)
                .join("text")
                .attr("class", "bar-label")
                .attr("x", -8)
                .attr("y", d => y(d.name) + y.bandwidth() / 2)
                .attr("dy", "0.35em")
                .attr("text-anchor", "end")
                .text(d => d.name.length > 18 ? d.name.substring(0,16)+"..." : d.name);

            // Value Labels
            svg.selectAll(".bar-value")
                .data(clusterList)
                .join("text")
                .attr("class", "bar-value")
                .attr("x", d => x(d.pct) + 5)
                .attr("y", d => y(d.name) + y.bandwidth() / 2)
                .attr("dy", "0.35em")
                .text(d => d.pct.toFixed(1) + "%");
        }

        initDetails();
    </script>
</body>
</html>