<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Subreddit Comparison Tool</title>
    
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        body {
            margin: 0;
            padding: 40px;
            background: #fff;
            font-family: 'IBM Plex Sans', -apple-system, sans-serif;
        }

        .comparison-container {
            max-width: 1000px;
            margin: 0 auto;
        }

        h2 {
            text-align: center;
            font-size: 28px;
            margin-bottom: 40px;
            color: #1a1a1a;
        }

        .selectors {
            display: grid;
            grid-template-columns: 1fr 100px 1fr;
            gap: 24px;
            margin-bottom: 50px;
            align-items: center;
        }

        .selector-box {
            background: #fafafa;
            padding: 24px;
            border-radius: 10px;
            border: 2px solid #e0e0e0;
        }

        .selector-box label {
            display: block;
            font-size: 12px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            color: #6a6a6a;
            margin-bottom: 12px;
        }

        .selector-box select {
            width: 100%;
            padding: 14px;
            font-size: 16px;
            font-weight: 600;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            background: #fff;
            cursor: pointer;
            font-family: 'IBM Plex Sans', sans-serif;
        }

        .selector-box select:focus {
            outline: none;
            border-color: #ff4500;
        }

        .vs {
            text-align: center;
            font-size: 32px;
            font-weight: 800;
            color: #ff4500;
        }

        .results {
            display: none;
        }

        .results.active {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 32px;
        }

        .result-card {
            background: #fafafa;
            border-radius: 12px;
            padding: 32px;
            border: 3px solid #e0e0e0;
            transition: all 0.3s;
        }

        .result-card.winner {
            border-color: #ff4500;
            background: #fff5f2;
            box-shadow: 0 8px 24px rgba(255, 69, 0, 0.2);
        }

        .result-card h3 {
            margin: 0 0 24px 0;
            font-size: 24px;
            color: #1a1a1a;
        }

        .result-card.winner h3 {
            color: #ff4500;
        }

        .result-card.winner h3::after {
            content: " üèÜ";
        }

        .metric {
            display: flex;
            justify-content: space-between;
            padding: 14px 0;
            border-bottom: 1px solid #e0e0e0;
        }

        .metric:last-child {
            border-bottom: none;
        }

        .metric-label {
            font-size: 14px;
            color: #6a6a6a;
            font-weight: 600;
        }

        .metric-value {
            font-size: 16px;
            font-weight: 700;
            color: #1a1a1a;
        }

        .chart-container {
            grid-column: 1 / -1;
            height: 450px;
            background: #fafafa;
            border-radius: 12px;
            padding: 32px;
            margin-top: 40px;
            border: 2px solid #e0e0e0;
        }

        .verdict {
            grid-column: 1 / -1;
            text-align: center;
            padding: 28px;
            background: #fff5f2;
            border: 3px solid #ff4500;
            border-radius: 12px;
            font-size: 20px;
            font-weight: 700;
            color: #ff4500;
            margin-top: 32px;
        }
    </style>
</head>
<body>

<div class="comparison-container">
    <h2>‚öîÔ∏è Subreddit Comparison Tool</h2>
    
    <div class="selectors">
        <div class="selector-box">
            <label>Subreddit Cluster 1</label>
            <select id="sub1">
                <option>Select a cluster...</option>
            </select>
        </div>
        
        <div class="vs">VS</div>
        
        <div class="selector-box">
            <label>Subreddit Cluster 2</label>
            <select id="sub2">
                <option>Select a cluster...</option>
            </select>
        </div>
    </div>

    <div class="results" id="results">
        <div class="result-card" id="card1">
            <h3 id="name1">Cluster 1</h3>
            <div class="metric">
                <span class="metric-label">Civility Score</span>
                <span class="metric-value" id="civ1">--</span>
            </div>
            <div class="metric">
                <span class="metric-label">PageRank (Influence)</span>
                <span class="metric-value" id="pr1">--</span>
            </div>
            <div class="metric">
                <span class="metric-label">Community Size</span>
                <span class="metric-value" id="size1">--</span>
            </div>
            <div class="metric">
                <span class="metric-label">Insularity</span>
                <span class="metric-value" id="ins1">--</span>
            </div>
            <div class="metric">
                <span class="metric-label">Internal Negativity</span>
                <span class="metric-value" id="neg1">--</span>
            </div>
        </div>

        <div class="result-card" id="card2">
            <h3 id="name2">Cluster 2</h3>
            <div class="metric">
                <span class="metric-label">Civility Score</span>
                <span class="metric-value" id="civ2">--</span>
            </div>
            <div class="metric">
                <span class="metric-label">PageRank (Influence)</span>
                <span class="metric-value" id="pr2">--</span>
            </div>
            <div class="metric">
                <span class="metric-label">Community Size</span>
                <span class="metric-value" id="size2">--</span>
            </div>
            <div class="metric">
                <span class="metric-label">Insularity</span>
                <span class="metric-value" id="ins2">--</span>
            </div>
            <div class="metric">
                <span class="metric-label">Internal Negativity</span>
                <span class="metric-value" id="neg2">--</span>
            </div>
        </div>

        <div class="chart-container">
            <canvas id="radarChart"></canvas>
        </div>

        <div class="verdict" id="verdict">
            Pick two clusters to see which would "win" in a network conflict!
        </div>
    </div>
</div>

<script>
let clusterData = null;
let radarChartInstance = null;

d3.json('../data/nodes.json').then(data => {
    clusterData = data;
    
    // Populate dropdowns
    const select1 = document.getElementById('sub1');
    const select2 = document.getElementById('sub2');
    
    data.forEach(cluster => {
        const opt1 = document.createElement('option');
        opt1.value = cluster.name;
        opt1.textContent = cluster.name;
        select1.appendChild(opt1);
        
        const opt2 = document.createElement('option');
        opt2.value = cluster.name;
        opt2.textContent = cluster.name;
        select2.appendChild(opt2);
    });
    
    // On change
    select1.addEventListener('change', compare);
    select2.addEventListener('change', compare);
});

function compare() {
    const name1 = document.getElementById('sub1').value;
    const name2 = document.getElementById('sub2').value;
    
    if (name1 === 'Select a cluster...' || name2 === 'Select a cluster...') return;
    if (name1 === name2) {
        alert('Please select two different clusters!');
        return;
    }
    
    const cluster1 = clusterData.find(c => c.name === name1);
    const cluster2 = clusterData.find(c => c.name === name2);
    
    if (!cluster1 || !cluster2) return;
    
    // Show results
    document.getElementById('results').classList.add('active');
    
    // Update cards
    document.getElementById('name1').textContent = cluster1.name;
    document.getElementById('name2').textContent = cluster2.name;
    
    const civ1 = (100 - cluster1.internal_negativity);
    const civ2 = (100 - cluster2.internal_negativity);
    
    document.getElementById('civ1').textContent = civ1.toFixed(1) + '%';
    document.getElementById('civ2').textContent = civ2.toFixed(1) + '%';
    
    document.getElementById('pr1').textContent = (cluster1.pagerank * 1000).toFixed(2);
    document.getElementById('pr2').textContent = (cluster2.pagerank * 1000).toFixed(2);
    
    document.getElementById('size1').textContent = cluster1.size.toLocaleString() + ' subs';
    document.getElementById('size2').textContent = cluster2.size.toLocaleString() + ' subs';
    
    document.getElementById('ins1').textContent = cluster1.insularity.toFixed(1) + '%';
    document.getElementById('ins2').textContent = cluster2.insularity.toFixed(1) + '%';
    
    document.getElementById('neg1').textContent = cluster1.internal_negativity.toFixed(1) + '%';
    document.getElementById('neg2').textContent = cluster2.internal_negativity.toFixed(1) + '%';
    
    // Determine winner (PageRank 50%, Civility 30%, Size 20%)
    const score1 = cluster1.pagerank * 0.5 + (civ1/100) * 0.3 + (cluster1.size / 10000) * 0.2;
    const score2 = cluster2.pagerank * 0.5 + (civ2/100) * 0.3 + (cluster2.size / 10000) * 0.2;
    
    const card1 = document.getElementById('card1');
    const card2 = document.getElementById('card2');
    
    if (score1 > score2) {
        card1.classList.add('winner');
        card2.classList.remove('winner');
        document.getElementById('verdict').textContent = 
            `${cluster1.name} would likely "win" due to higher influence (PageRank: ${(cluster1.pagerank*1000).toFixed(1)}) and ${civ1 > civ2 ? 'better civility' : 'larger size'}!`;
    } else {
        card2.classList.add('winner');
        card1.classList.remove('winner');
        document.getElementById('verdict').textContent = 
            `${cluster2.name} would likely "win" due to higher influence (PageRank: ${(cluster2.pagerank*1000).toFixed(1)}) and ${civ2 > civ1 ? 'better civility' : 'larger size'}!`;
    }
    
    // Radar chart
    renderRadarComparison(cluster1, cluster2);
}

function renderRadarComparison(c1, c2) {
    const ctx = document.getElementById('radarChart').getContext('2d');
    
    if (radarChartInstance) radarChartInstance.destroy();
    
    // Normalize LIWC scores to 0-100 scale
    const data1 = [
        Math.min(100, (c1.Anger / 0.03) * 100),
        Math.min(100, (c1.Negemo / 0.05) * 100),
        Math.min(100, (c1.Posemo / 0.08) * 100),
        Math.min(100, (c1.Certain / 0.02) * 100),
        Math.min(100, (c1.CogMech / 0.15) * 100),
        Math.min(100, (c1.Social / 0.12) * 100)
    ];
    
    const data2 = [
        Math.min(100, (c2.Anger / 0.03) * 100),
        Math.min(100, (c2.Negemo / 0.05) * 100),
        Math.min(100, (c2.Posemo / 0.08) * 100),
        Math.min(100, (c2.Certain / 0.02) * 100),
        Math.min(100, (c2.CogMech / 0.15) * 100),
        Math.min(100, (c2.Social / 0.12) * 100)
    ];
    
    radarChartInstance = new Chart(ctx, {
        type: 'radar',
        data: {
            labels: ['Anger', 'Negative Emotion', 'Positive Emotion', 'Certainty', 'Cognitive', 'Social'],
            datasets: [
                {
                    label: c1.name,
                    data: data1,
                    backgroundColor: 'rgba(255, 69, 0, 0.15)',
                    borderColor: '#ff4500',
                    pointBackgroundColor: '#ff4500',
                    pointBorderColor: '#fff',
                    pointBorderWidth: 2,
                    borderWidth: 3
                },
                {
                    label: c2.name,
                    data: data2,
                    backgroundColor: 'rgba(17, 236, 32, 0.15)',
                    borderColor: '#11ec20',
                    pointBackgroundColor: '#11ec20',
                    pointBorderColor: '#fff',
                    pointBorderWidth: 2,
                    borderWidth: 3
                }
            ]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
                r: {
                    angleLines: { color: 'rgba(0, 0, 0, 0.1)' },
                    grid: { color: 'rgba(0, 0, 0, 0.1)' },
                    pointLabels: { 
                        color: '#1a1a1a',
                        font: { size: 13, weight: '600', family: 'IBM Plex Sans' }
                    },
                    ticks: { 
                        display: true,
                        stepSize: 20,
                        color: '#6a6a6a',
                        font: { size: 11 }
                    },
                    max: 100,
                    min: 0
                }
            },
            plugins: {
                legend: {
                    position: 'top',
                    labels: {
                        font: { size: 15, weight: '700', family: 'IBM Plex Sans' },
                        color: '#1a1a1a',
                        padding: 20
                    }
                },
                tooltip: {
                    backgroundColor: 'rgba(0, 0, 0, 0.8)',
                    padding: 12,
                    titleFont: { size: 14, weight: '700' },
                    bodyFont: { size: 13 }
                }
            }
        }
    });
}
</script>

</body>
</html>